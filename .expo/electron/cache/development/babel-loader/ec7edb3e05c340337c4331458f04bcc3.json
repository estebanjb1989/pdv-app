{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.request = request;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _effects = require(\"redux-saga/effects\");\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _settings = _interopRequireDefault(require(\"../../settings\"));\n\nvar _types = require(\"../types\");\n\nvar _marked = _regenerator.default.mark(apiCall),\n    _marked2 = _regenerator.default.mark(handleError),\n    _marked3 = _regenerator.default.mark(request);\n\n_axios.default.defaults.validateStatus = function (status) {\n  return status >= 200 && status < 300;\n};\n\n_axios.default.defaults.timeout = 20000;\n\n_axios.default.interceptors.request.use(function (req) {\n  try {\n    if (!req.url) {\n      return req;\n    }\n\n    console.info(req.method, '>>', req.url);\n  } catch (err) {\n    console.error(err);\n  }\n\n  return req;\n});\n\nfunction apiCall(action, headers) {\n  var _action$payload, _action$payload2, _action$payload3, _action$payload4;\n\n  var useLocale,\n      method,\n      response,\n      url,\n      currentLang,\n      _action$payload5,\n      _action$payload6,\n      _args = arguments;\n\n  return _regenerator.default.wrap(function apiCall$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          useLocale = _args.length > 2 && _args[2] !== undefined ? _args[2] : false;\n          method = ((_action$payload = action.payload) === null || _action$payload === void 0 ? void 0 : _action$payload.method) || 'post';\n          response = null;\n          url = ((_action$payload2 = action.payload) === null || _action$payload2 === void 0 ? void 0 : _action$payload2.urlAbsolute) || \"\" + _settings.default.apiUrl + ((_action$payload3 = action.payload) === null || _action$payload3 === void 0 ? void 0 : _action$payload3.url);\n          _context.next = 6;\n          return (0, _effects.select)(function (state) {\n            var _state$session$langua;\n\n            return (_state$session$langua = state.session.languageSelected) === null || _state$session$langua === void 0 ? void 0 : _state$session$langua.slug;\n          });\n\n        case 6:\n          currentLang = _context.sent;\n          _axios.default.defaults.headers.common['Accept'] = 'application/json;charset=UTF-8';\n          _axios.default.defaults.headers.common['Content-Type'] = 'application/json';\n          _axios.default.defaults.headers.common['Accept-Language'] = currentLang;\n\n          if (headers !== null && headers !== void 0 && headers.Authorization) {\n            _axios.default.defaults.headers.common['Authorization'] = headers.Authorization;\n          }\n\n          if ((_action$payload4 = action.payload) !== null && _action$payload4 !== void 0 && _action$payload4.isPublicEndpoint) {\n            _axios.default.defaults.headers.common['Authorization'] = null;\n          }\n\n          if (!(method === 'get')) {\n            _context.next = 18;\n            break;\n          }\n\n          _context.next = 15;\n          return (0, _effects.call)(_axios.default.request, {\n            method: 'get',\n            url: url,\n            headers: {\n              Authorization: headers === null || headers === void 0 ? void 0 : headers.Authorization\n            }\n          });\n\n        case 15:\n          response = _context.sent;\n          _context.next = 21;\n          break;\n\n        case 18:\n          _context.next = 20;\n          return (0, _effects.call)(_axios.default[method], ((_action$payload5 = action.payload) === null || _action$payload5 === void 0 ? void 0 : _action$payload5.urlAbsolute) || \"\" + (useLocale ? '/en' : '') + url, (_action$payload6 = action.payload) === null || _action$payload6 === void 0 ? void 0 : _action$payload6.params);\n\n        case 20:\n          response = _context.sent;\n\n        case 21:\n          return _context.abrupt(\"return\", response);\n\n        case 22:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction handleError(action, error) {\n  var _error$response, _error$response2, _error$response3, _error$response3$data, _error$response5, _error$response5$data, _error$response7, _error$response7$data, _action$payload7;\n\n  var _error$response4, _error$response4$data, _error$response6, _error$response6$data;\n\n  return _regenerator.default.wrap(function handleError$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return (0, _effects.put)({\n            type: _types.RequestTypes.ERROR,\n            payload: {\n              status: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status,\n              error: ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || error.toString()\n            }\n          });\n\n        case 2:\n          if (!(error.response.status === 500)) {\n            _context2.next = 5;\n            break;\n          }\n\n          _context2.next = 5;\n          return (0, _effects.put)({\n            type: _types.MsgBoxTypes.TOGGLE,\n            mode: 'text',\n            title: 'Unidos',\n            children: 'An error occured, please try again later'\n          });\n\n        case 5:\n          if (!(error !== null && error !== void 0 && (_error$response3 = error.response) !== null && _error$response3 !== void 0 && (_error$response3$data = _error$response3.data) !== null && _error$response3$data !== void 0 && _error$response3$data.detail)) {\n            _context2.next = 8;\n            break;\n          }\n\n          _context2.next = 8;\n          return (0, _effects.put)({\n            type: _types.MsgBoxTypes.TOGGLE,\n            mode: 'text',\n            title: 'Error',\n            children: error === null || error === void 0 ? void 0 : (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : (_error$response4$data = _error$response4.data) === null || _error$response4$data === void 0 ? void 0 : _error$response4$data.detail\n          });\n\n        case 8:\n          if (!(error !== null && error !== void 0 && (_error$response5 = error.response) !== null && _error$response5 !== void 0 && (_error$response5$data = _error$response5.data) !== null && _error$response5$data !== void 0 && _error$response5$data.non_field_errors)) {\n            _context2.next = 11;\n            break;\n          }\n\n          _context2.next = 11;\n          return (0, _effects.put)({\n            type: _types.MsgBoxTypes.TOGGLE,\n            mode: 'text',\n            title: 'Error',\n            children: error === null || error === void 0 ? void 0 : (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : (_error$response6$data = _error$response6.data) === null || _error$response6$data === void 0 ? void 0 : _error$response6$data.non_field_errors.join(',')\n          });\n\n        case 11:\n          if (!((error === null || error === void 0 ? void 0 : (_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : (_error$response7$data = _error$response7.data) === null || _error$response7$data === void 0 ? void 0 : _error$response7$data.detail) === 'Invalid token header. No credentials provided.')) {\n            _context2.next = 14;\n            break;\n          }\n\n          _context2.next = 14;\n          return (0, _effects.put)({\n            type: _types.MsgBoxTypes.TOGGLE,\n            mode: 'text',\n            title: 'Error',\n            children: 'In order to protect your information, we logged you out. Kindly sign in again.'\n          });\n\n        case 14:\n          if ((_action$payload7 = action.payload) !== null && _action$payload7 !== void 0 && _action$payload7.onError) {\n            action.payload.onError(error);\n          }\n\n        case 15:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction request() {\n  var headers;\n  return _regenerator.default.wrap(function request$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          headers = {};\n          _context4.next = 3;\n          return (0, _effects.takeEvery)(_types.RequestTypes.START, _regenerator.default.mark(function _callee(action) {\n            var tokenData, _response, _response2, response, _error$response8, _error$response8$data, _error$response9, _error$response9$data, _error$response10, _error$response10$dat, _retryError$response, _retryError$response$, _retryError$response2, _error$response11, _error$response12;\n\n            return _regenerator.default.wrap(function _callee$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    _context3.next = 2;\n                    return (0, _effects.select)(function (state) {\n                      return state.session.tokenData;\n                    });\n\n                  case 2:\n                    tokenData = _context3.sent;\n\n                    if (tokenData !== null && tokenData !== void 0 && tokenData.access_token) {\n                      headers = {\n                        Authorization: \"Bearer \" + tokenData.access_token\n                      };\n                    }\n\n                    _context3.prev = 4;\n                    response = null;\n                    _context3.next = 8;\n                    return (0, _effects.call)(apiCall, action, headers);\n\n                  case 8:\n                    response = _context3.sent;\n\n                    if (!((_response = response) !== null && _response !== void 0 && _response.data && typeof response.data === 'string')) {\n                      _context3.next = 11;\n                      break;\n                    }\n\n                    throw response.data;\n\n                  case 11:\n                    _context3.next = 13;\n                    return (0, _effects.put)({\n                      type: _types.RequestTypes.SUCCESS,\n                      payload: ((_response2 = response) === null || _response2 === void 0 ? void 0 : _response2.data) || []\n                    });\n\n                  case 13:\n                    if (action.payload.onSuccess) {\n                      action.payload.onSuccess(response.data);\n                    }\n\n                    _context3.next = 36;\n                    break;\n\n                  case 16:\n                    _context3.prev = 16;\n                    _context3.t0 = _context3[\"catch\"](4);\n\n                    if (!((_context3.t0 === null || _context3.t0 === void 0 ? void 0 : (_error$response8 = _context3.t0.response) === null || _error$response8 === void 0 ? void 0 : (_error$response8$data = _error$response8.data) === null || _error$response8$data === void 0 ? void 0 : _error$response8$data.detail) === 'Invalid token header. No credentials provided.')) {\n                      _context3.next = 21;\n                      break;\n                    }\n\n                    _context3.next = 21;\n                    return (0, _effects.put)({\n                      type: _types.AuthTypes.LOGOUT_SUCCESS\n                    });\n\n                  case 21:\n                    if (!((_context3.t0 === null || _context3.t0 === void 0 ? void 0 : (_error$response9 = _context3.t0.response) === null || _error$response9 === void 0 ? void 0 : (_error$response9$data = _error$response9.data) === null || _error$response9$data === void 0 ? void 0 : _error$response9$data.detail) === 'Authentication credentials were not provided.' || ((_error$response10 = _context3.t0.response) === null || _error$response10 === void 0 ? void 0 : (_error$response10$dat = _error$response10.data) === null || _error$response10$dat === void 0 ? void 0 : _error$response10$dat.code) === 'token_not_valid')) {\n                      _context3.next = 34;\n                      break;\n                    }\n\n                    _context3.prev = 22;\n                    _context3.next = 32;\n                    break;\n\n                  case 25:\n                    _context3.prev = 25;\n                    _context3.t1 = _context3[\"catch\"](22);\n\n                    if (!(((_retryError$response = _context3.t1.response) === null || _retryError$response === void 0 ? void 0 : (_retryError$response$ = _retryError$response.data) === null || _retryError$response$ === void 0 ? void 0 : _retryError$response$.code) === 'token_not_valid' || ((_retryError$response2 = _context3.t1.response) === null || _retryError$response2 === void 0 ? void 0 : _retryError$response2.status) === 500)) {\n                      _context3.next = 30;\n                      break;\n                    }\n\n                    _context3.next = 30;\n                    return (0, _effects.put)({\n                      type: _types.AuthTypes.LOGOUT_SUCCESS\n                    });\n\n                  case 30:\n                    _context3.next = 32;\n                    return (0, _effects.put)({\n                      type: _types.RequestTypes.ERROR,\n                      payload: {\n                        status: (_error$response11 = _context3.t0.response) === null || _error$response11 === void 0 ? void 0 : _error$response11.status,\n                        error: ((_error$response12 = _context3.t0.response) === null || _error$response12 === void 0 ? void 0 : _error$response12.data) || _context3.t0.toString()\n                      }\n                    });\n\n                  case 32:\n                    _context3.next = 36;\n                    break;\n\n                  case 34:\n                    _context3.next = 36;\n                    return (0, _effects.call)(handleError, action, _context3.t0);\n\n                  case 36:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, _callee, null, [[4, 16], [22, 25]]);\n          }));\n\n        case 3:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked3);\n}","map":{"version":3,"sources":["/Users/estebanjoaquin/src/examples/pdv-app/redux/modules/request.js"],"names":["axios","status","req","console","apiCall","useLocale","method","response","url","settings","action","currentLang","select","state","headers","call","Authorization","handleError","put","type","RequestTypes","payload","error","MsgBoxTypes","mode","title","children","request","takeEvery","tokenData","AuthTypes"],"mappings":"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","sourcesContent":["import { takeEvery, call, put, select } from 'redux-saga/effects'\nimport axios from 'axios'\nimport settings from '../../settings'\nimport { RequestTypes, MsgBoxTypes, TokenTypes, AuthTypes } from '../types'\n/*import Path from 'navigation/Path'\nimport { navigate } from 'navigation/Navigator'\nimport { Endpoints as AuthEndpoints } from 'redux/modules/auth'*/\n\naxios.defaults.validateStatus = (status) => status >= 200 && status < 300\naxios.defaults.timeout = 20000\naxios.interceptors.request.use((req) => {\n  try {\n    if (!req.url) {\n      return req\n    }\n    console.info(req.method, '>>', req.url)\n  } catch (err) {\n    console.error(err)\n  }\n  return req\n})\n\nfunction* apiCall(action, headers, useLocale = false) {\n  const method = action.payload?.method || 'post'\n  let response = null\n  const url =\n    action.payload?.urlAbsolute || `${settings.apiUrl}${action.payload?.url}`\n\n  const currentLang = yield select(\n    (state) => state.session.languageSelected?.slug\n  )\n\n  axios.defaults.headers.common['Accept'] = 'application/json;charset=UTF-8'\n  axios.defaults.headers.common['Content-Type'] = 'application/json'\n  axios.defaults.headers.common['Accept-Language'] = currentLang\n\n  if (headers?.Authorization) {\n    axios.defaults.headers.common['Authorization'] = headers.Authorization\n  }\n\n  if (action.payload?.isPublicEndpoint) {\n    axios.defaults.headers.common['Authorization'] = null\n  }\n\n  if (method === 'get') {\n    response = yield call(axios.request, {\n      method: 'get',\n      url,\n      headers: {\n        Authorization: headers?.Authorization,\n      },\n    })\n  } else {\n    response = yield call(\n      axios[method],\n      action.payload?.urlAbsolute || `${useLocale ? '/en' : ''}${url}`,\n      action.payload?.params\n    )\n  }\n\n  return response\n}\n\nfunction* handleError(action, error) {\n  yield put({\n    type: RequestTypes.ERROR,\n    payload: {\n      status: error.response?.status,\n      error: error.response?.data || error.toString(),\n    },\n  })\n\n  if (error.response.status === 500) {\n    yield put({\n      type: MsgBoxTypes.TOGGLE,\n      mode: 'text',\n      title: 'Unidos',\n      children: 'An error occured, please try again later',\n    })\n  }\n\n  if (error?.response?.data?.detail) {\n    yield put({\n      type: MsgBoxTypes.TOGGLE,\n      mode: 'text',\n      title: 'Error',\n      children: error?.response?.data?.detail,\n    })\n  }\n\n  if (error?.response?.data?.non_field_errors) {\n    yield put({\n      type: MsgBoxTypes.TOGGLE,\n      mode: 'text',\n      title: 'Error',\n      children: error?.response?.data?.non_field_errors.join(','),\n    })\n  }\n\n  if (\n    error?.response?.data?.detail ===\n    'Invalid token header. No credentials provided.'\n  ) {\n    yield put({\n      type: MsgBoxTypes.TOGGLE,\n      mode: 'text',\n      title: 'Error',\n      children:\n        'In order to protect your information, we logged you out. Kindly sign in again.',\n    })\n  }\n\n  if (action.payload?.onError) {\n    action.payload.onError(error)\n  }\n}\n\nexport function* request() {\n  let headers = {}\n\n  yield takeEvery(RequestTypes.START, function* (action) {\n    const tokenData = yield select((state) => state.session.tokenData)\n\n    if (tokenData?.access_token) {\n      headers = {\n        Authorization: `Bearer ${tokenData.access_token}`,\n      }\n    }\n\n    try {\n      let response = null\n      response = yield call(apiCall, action, headers)\n\n      if (response?.data && typeof response.data === 'string') {\n        // Got HTML response\n        throw response.data\n      }\n\n      yield put({\n        type: RequestTypes.SUCCESS,\n        payload: response?.data || [],\n      })\n\n      if (action.payload.onSuccess) {\n        action.payload.onSuccess(response.data)\n      }\n    } catch (error) {\n      if (\n        error?.response?.data?.detail ===\n        'Invalid token header. No credentials provided.'\n      ) {\n        /*navigate(Path.Public.Root, {\n          screen: Path.Public.Onboard.SignIn,\n        })*/\n        yield put({\n          type: AuthTypes.LOGOUT_SUCCESS,\n        })\n      }\n\n      if (\n        error?.response?.data?.detail ===\n          'Authentication credentials were not provided.' ||\n        error.response?.data?.code === 'token_not_valid'\n      ) {\n        try {\n          /*const refreshResponse = yield call(apiCall, {\n            payload: {\n              url: AuthEndpoints.Token,\n              params: {\n                grant_type: 'refresh_token',\n                refresh_token: tokenData.refresh,\n              },\n              isPublicEndpoint: true,\n            },\n          })\n\n          const { access } = refreshResponse.data\n\n          yield put({\n            type: TokenTypes.TOKEN_SUCCESS,\n            payload: { ...tokenData, access },\n          })\n\n          headers = {\n            Authorization: `Bearer ${access}`,\n          }\n          const response = yield call(apiCall, action, headers)\n          yield put({\n            type: RequestTypes.SUCCESS,\n            payload: response.data,\n          })\n          if (action.payload.onSuccess) {\n            action.payload.onSuccess(response.data)\n          }*/\n        } catch (retryError) {\n          if (\n            retryError.response?.data?.code === 'token_not_valid' ||\n            retryError.response?.status === 500\n          ) {\n            /*navigate(Path.Public.Root, {\n              screen: Path.Public.Onboard.SignIn,\n            })*/\n            yield put({\n              type: AuthTypes.LOGOUT_SUCCESS,\n            })\n          }\n          yield put({\n            type: RequestTypes.ERROR,\n            payload: {\n              status: error.response?.status,\n              error: error.response?.data || error.toString(),\n            },\n          })\n        }\n      } else {\n        yield call(handleError, action, error)\n      }\n    }\n  })\n}\n"]},"metadata":{},"sourceType":"script"}